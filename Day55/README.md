# Day 55 - Challenge 
# ðŸ§© Task: Implement Sidecar Pattern for Nginx Log Shipping

# Description:
# We have a web server container running the nginx image. 
# The access and error logs generated by the web server are not critical enough 
# to be placed on a persistent volume. However, Nautilus developers need access 
# to the last 24 hours of logs to trace issues and bugs.
#
# Therefore, we will use the Sidecar pattern â€” deploying a second container 
# that ships the logs from the nginx container. Since both containers are 
# running on the same Pod, they can use a shared emptyDir volume to read 
# and write logs.
#
# Requirements:
# 1. Create a pod named webserver.
# 2. Create an emptyDir volume named shared-logs.
# 3. Add two containers:
#    - nginx-container: uses image nginx:latest
#    - sidecar-container: uses image ubuntu:latest
# 4. sidecar-container should run the command:
#      "sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"
# 5. Mount the shared-logs volume to both containers at /var/log/nginx.
# 6. All containers should be in Running state.

# âœ… Solution YAML (Correct and Tested)
apiVersion: v1
kind: Pod
metadata:
  name: webserver
spec:
  volumes:
    - name: shared-logs
      emptyDir: {}
  containers:
    - name: nginx-container
      image: nginx:latest
      volumeMounts:
        - name: shared-logs
          mountPath: /var/log/nginx

    - name: sidecar-container
      image: ubuntu:latest
      command: ["sh", "-c", "while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"]
      volumeMounts:
        - name: shared-logs
          mountPath: /var/log/nginx

# After applying this YAML:
# 1. The nginx container will write logs to /var/log/nginx (shared volume).
# 2. The ubuntu sidecar container will continuously read and print those logs every 30 seconds.
# 3. Both containers share the same emptyDir volume, meaning logs are accessible to both.

# Commands to run:
# kubectl apply -f webserver-pod.yaml
# kubectl get pods
# kubectl logs -f webserver -c sidecar-container
